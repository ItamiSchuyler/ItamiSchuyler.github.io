<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Escritorio Itami</title>

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
html,body{margin:0;width:100%;height:100%;overflow:hidden;background:#000}

/* Fondo */
#video-bg{
  position:fixed;inset:0;
  width:100%;height:100%;
  object-fit:cover;z-index:-1;
}

/* Escritorio */
#desktop{position:relative;width:100%;height:100%;padding:20px}

/* Carpetas: doble click + arrastrar */
document.querySelectorAll('.folder').forEach(folder=>{
  let clicks = 0;
  let isDragging = false;
  let offsetX = 0, offsetY = 0;

  folder.addEventListener('mousedown', e => {
    offsetX = e.offsetX;
    offsetY = e.offsetY;
    isDragging = false;

    document.onmousemove = ev => {
      isDragging = true;
      folder.style.left = (ev.pageX - offsetX) + 'px';
      folder.style.top  = (ev.pageY - offsetY) + 'px';
    };

    document.onmouseup = () => {
      document.onmousemove = null;

      if (!isDragging) {
        clicks++;
        folder.classList.add('selected');
        setTimeout(()=>folder.classList.remove('selected'),150);
        setTimeout(()=>clicks=0,300);
        if (clicks === 2) openWin(folder.dataset.open);
      }
    };
  });
});
});

/* Arrastrar ventanas */
document.querySelectorAll('.window').forEach(w=>{
  const bar=w.querySelector('.titlebar');
  bar.onmousedown=e=>{
    const r=w.getBoundingClientRect();
    const ox=e.clientX-r.left,oy=e.clientY-r.top;
    document.onmousemove=ev=>{
      w.style.left=(ev.clientX-ox)+'px';
      w.style.top=(ev.clientY-oy)+'px';
    };
    document.onmouseup=()=>document.onmousemove=null;
  };
});

/* Chat */
const chats={Ana:['Hola ðŸ‘‹','QuÃ© buen portfolio'],Carlos:['Esto parece Windows ðŸ˜®','Muy pro']};
const friends=document.getElementById('friends');
const chatBox=document.getElementById('chatBox');
Object.keys(chats).forEach(n=>{
  const f=document.createElement('div');
  f.className='friend';
  f.innerHTML=`<img src="https://i.pravatar.cc/100?u=${n}">${n}`;
  f.onclick=()=>loadChat(n);
  friends.appendChild(f);
});
function loadChat(n){chatBox.innerHTML='';chats[n].forEach((t,i)=>{setTimeout(()=>{
  const d=document.createElement('div');
  d.className='msg '+(i%2?'me':'them');
  d.textContent=t;chatBox.appendChild(d);
},i*400);});}

/* Player FIX */
const tracks=[{name:'Justin Bieber - She's Confidence',src:'song.mp3'}];
const audio=document.getElementById('audio');
const play=document.getElementById('play');
const bar=document.getElementById('bar');
const vol=document.getElementById('volume');
const list=document.getElementById('playlist');

tracks.forEach((t,i)=>{
  const d=document.createElement('div');
  d.className='track';d.textContent=t.name;
  d.onclick=()=>{audio.src=t.src;audio.play();play.textContent='â¸';};
  list.appendChild(d);
});

play.onclick=()=>{
  if(!audio.src)audio.src=tracks[0].src;
  if(audio.paused){audio.play();play.textContent='â¸'}
  else{audio.pause();play.textContent='â–¶'}
};

audio.ontimeupdate=()=>{if(audio.duration)bar.style.width=(audio.currentTime/audio.duration*100)+'%'};
vol.oninput=()=>audio.volume=vol.value;

/* Reloj */
function updateClock(){
  const d=new Date();
  document.getElementById('clock').innerHTML=
    d.toLocaleTimeString().slice(0,5)+'<br>'+d.toLocaleDateString();
}
setInterval(updateClock,1000);updateClock();
</script>

</body>
</html>
